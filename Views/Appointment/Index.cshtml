@model List<Appointment>
@{
    ViewData["Title"] = "Home Page";
}
<div class="calendar">
    <div class="time-column">
        @for (var time = DateTime.Today.AddHours(9); time <= DateTime.Today.AddHours(17); time = time.AddMinutes(30))
        {
            <div class="time-header">@time.ToString("HH:mm")</div>
        }
    </div>
    
    <div class="appointments-column">
        @foreach (var appointment in Model)
        {
            DateTime appointmentEnd = appointment.Date.Add(appointment.AppointmentLength);

            <div class="appointment"
                 style="top: @(CalculateTopPosition(appointment.Date))%;
                        height: @(CalculateAppointmentHeight(appointment.Date, appointmentEnd))%;
                        left: @(CalculateLeftPosition(appointment.Date))%;
                        width: @(CalculateAppointmentWidth(appointment.Date, appointmentEnd))%;">
                <div class="Name">@appointment.Name</div>
                <div class="AnimalType">@appointment.Animal</div>
            </div>
        }
    </div>
    
</div>
<div style="margin-top: 20px; text-align: center;">
    <a asp-action="Create" class="btn btn-primary">Create Appointment</a>
</div>

<style>
    .calendar {
        display: flex;
        width: 100%;
        height: 100%;
    }

    .time-column {
        display: flex;
        flex-direction: column;
        width: 120px; 
    }

    .time-header {
        padding: 5px;
        border-top: 1px solid #ccc;
        border-left: 1px solid #ccc;
        border-right: 1px solid #ccc;
    }

    .appointments-column {
        position: relative;
        flex-grow: 1;
        margin-left: -1px;
    }

    .appointment {
        position: absolute;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        padding: 5px;
        overflow: hidden;
    }

    .Name {
        font-weight: bold;
        margin-bottom: 3px;
    }

    .AnimalType {
        font-size: 0.9em;
    }
</style>

@functions {
    // Function to calculate the top position of the appointment based on its start time
    double CalculateTopPosition(DateTime startTime)
    {
        TimeSpan fromNineAM = startTime.TimeOfDay - TimeSpan.FromHours(9);
        double percentageFromNineAM = (fromNineAM.TotalMinutes / (8 * 59)) * 100;
        return percentageFromNineAM;
    }

    // Function to calculate the height of the appointment based on its start and end times
    double CalculateAppointmentHeight(DateTime startTime, DateTime endTime)
    {
        TimeSpan duration = endTime - startTime;
        double appointmentDurationMinutes = duration.TotalMinutes;
        double percentageOfTotalDay = (appointmentDurationMinutes / (8 * 60)) * 100;
        percentageOfTotalDay = Math.Floor(percentageOfTotalDay);
        return percentageOfTotalDay;
    }

    // Function to calculate the left position of the appointment based on its start time
    double CalculateLeftPosition(DateTime startTime)
    {
        TimeSpan fromNineAM = startTime.TimeOfDay - TimeSpan.FromHours(9);
        double percentageFromNineAM = (fromNineAM.TotalMinutes / (8 * 60)) * 100;
        return percentageFromNineAM;
    }

    // Function to calculate the width of the appointment based on its start and end times
    double CalculateAppointmentWidth(DateTime startTime, DateTime endTime)
    {
        TimeSpan duration = endTime - startTime;
        double appointmentDurationMinutes = duration.TotalMinutes;
        double percentageOfTotalDay = (appointmentDurationMinutes / (8 * 60)) * 100;
        return percentageOfTotalDay;
    }
}